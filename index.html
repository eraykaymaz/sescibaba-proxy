<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Stok Test</title></head>
<body>

<input id="u" style="width:500px;font-size:18px" placeholder="ürün linki">
<button onclick="test()">Kontrol Et</button>

<pre id="sonuc" style="font-size:20px;margin-top:20px;color:#333"></pre>

<script>
async function test(){
  let url = document.getElementById("u").value;
  if(!url) return;

  // Worker proxy
  let proxy = "https://test.eray-kaymaz.workers.dev/?url=";
  let html = await (await fetch(proxy + encodeURIComponent(url))).text();

  // PRODUCT_DATA JSON'unu bul
  let match = html.match(/window\['PRODUCT_DATA'\]\s*=\s*(\{.*?\});/s);

  if(!match){
    document.getElementById("sonuc").innerText = "JSON bulunamadı!";
    return;
  }

  let json = JSON.parse(match[1]);

  let stok = json.STOCK === "0" ? "YOK" : "VAR";
  let text = json.STOCK_TEXT;

  document.getElementById("sonuc").innerText =
    "Stok: " + stok + "\n" +
    "Metin: " + text;
}
</script>

</body>
</html>
